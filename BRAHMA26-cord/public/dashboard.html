<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BRAHMA'26 Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: 'Inter', sans-serif;
  background: #0b0f14;
  color: #eaeaea;
  padding: 20px 30px;
}

/* ================= TOP BAR ================= */
.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 25px;
}

.brand {
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
}

.logo {
  width: 42px;
  height: 42px;
  border-radius: 25px;
  transition: transform 0.4s ease, filter 0.4s ease;
}

.brand-text {
  margin: 0;
  font-size: 24px;
  font-weight: 700;
  letter-spacing: 1px;
  transition: letter-spacing 0.4s ease, color 0.4s ease;
}

.brand:hover .logo {
  transform: rotate(-6deg) scale(1.08);
  filter: drop-shadow(0 0 6px rgba(255,255,255,0.25));
}

.brand:hover .brand-text {
  letter-spacing: 3px;
  color: #ffffff;
}

.logout {
  padding: 8px 16px;
  border: 1px solid #444;
  background: transparent;
  color: #ddd;
  cursor: pointer;
  border-radius: 6px;
  transition: all 0.3s ease;
}

.logout:hover {
  background: #e63946;
  border-color: #e63946;
  color: #fff;
}

/* ================= EVENT INFO ================= */
.event-info {
  text-align: center;
  margin-bottom: 20px;
}

.event-info h2 {
  margin: 0;
  font-weight: 600;
}

.event-info p {
  margin: 4px 0 0;
  color: #aaa;
}

/* ================= ACTION BUTTONS ================= */
.actions {
  text-align: center;
  margin-bottom: 20px;
}

.actions button {
  padding: 10px 18px;
  margin: 5px;
  border-radius: 6px;
  border: 1px solid #333;
  background: #121821;
  color: #ddd;
  cursor: pointer;
  transition: all 0.3s ease;
}

.actions button:hover {
  background: #1f2937;
  transform: translateY(-2px);
}

/* ================= COUNT ================= */
.count {
  text-align: center;
  margin-bottom: 15px;
  font-size: 17px;
}

/* ================= SLIDER ================= */
.slider-wrapper {
  overflow: hidden;
}

.container {
  display: flex;
  width: 200%;
  transition: transform 0.5s ease;
}

.panel {
  width: 50%;
  padding: 10px;
}

/* ================= TABLE ================= */
.table-box {
  background: #121821;
  border-radius: 6px;
  padding: 15px;
  border: 1px solid #222;
}

.table-box h3 {
  margin-top: 0;
  font-weight: 600;
}

/* ===== TABLE CONTROLS ===== */
.table-controls {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}

.table-controls input,
.table-controls select {
  padding: 8px 10px;
  border-radius: 6px;
  border: 1px solid #333;
  background: #0f1623;
  color: #ddd;
  outline: none;
}

.table-controls input::placeholder {
  color: #888;
}

.table-controls select {
  cursor: pointer;
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 10px;
}

th, td {
  padding: 10px;
  border-bottom: 1px solid #2a2a2a;
  text-align: left;
}

th {
  color: #07fac5;
  font-weight: 600;
}

.status-true {
  color: #2ecc71;
  font-weight: 600;
}

.status-false {
  color: #e74c3c;
  font-weight: 600;
}

.back-btn {
  margin-bottom: 10px;
  padding: 8px 14px;
  border: 1px solid #333;
  background: transparent;
  color: #ccc;
  cursor: pointer;
  border-radius: 6px;
}

.back-btn:hover {
  background: #1f2937;
}
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="topbar">
  <div class="brand">
    <img src="Blogo.jpeg" alt="Logo" class="logo">
    <h1 class="brand-text">BRAHMA'26</h1>
  </div>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<!-- EVENT INFO -->
<div class="event-info">
  <h2 id="eventName"></h2>
  <p id="eventId"></p>
</div>

<!-- ACTION BUTTONS -->
<div class="actions">
  <button onclick="showDashboard()">Dashboard</button>
  <button onclick="window.location.href='scan.html'">Scan / Register</button>
  <button onclick="showAttendance()">Attendance</button>
</div>

<!-- COUNT -->
<div class="count">
  Total Registrations: <strong><span id="count">Loading...</span></strong>
</div>

<!-- SLIDER -->
<div class="slider-wrapper">
  <div class="container" id="slider">

    <!-- DASHBOARD -->
    <div class="panel">
      <div class="table-box">
        <h3>Registered Participants</h3>

        <!-- CONTROLS -->
        <div class="table-controls">
          <input type="text" id="searchInput" placeholder="Search student..." oninput="applyFilters()">
          <select id="statusFilter" onchange="applyFilters()">
            <option value="all">All</option>
            <option value="registered">Registered</option>
            <option value="not">Not Registered</option>
          </select>
          <select id="sortOrder" onchange="applyFilters()">
            <option value="az">A → Z</option>
            <option value="za">Z → A</option>
          </select>
        </div>

        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="dashboardTable"></tbody>
        </table>
      </div>
    </div>

    <!-- ATTENDANCE -->
    <div class="panel">
      <div class="table-box">
        <h3>Attendance List</h3>
        <table>
          <thead>
            <tr>
              <th>Student Name</th>
            </tr>
          </thead>
          <tbody id="attendanceTable"></tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<script>
const eventId = localStorage.getItem("event_id");
const eventName = localStorage.getItem("event_name");
const slider = document.getElementById("slider");

if (!eventId || !eventName) {
  alert("Session expired. Please login again.");
  window.location.href = "login.html";
}

document.getElementById("eventName").innerText = eventName;
document.getElementById("eventId").innerText = "Event ID: " + eventId;

function showAttendance() {
  slider.style.transform = "translateX(-50%)";
  loadAttendance();
}

function showDashboard() {
  slider.style.transform = "translateX(0)";
}

function logout() {
  localStorage.clear();
  window.location.href = "login.html";
}

fetch(`/count/${eventId}`)
  .then(res => res.json())
  .then(data => {
    document.getElementById("count").innerText = data.count;
  });

let dashboardData = [];

function loadDashboard() {
  fetch(`/tickets/${eventId}`)
    .then(res => res.json())
    .then(data => {
      dashboardData = data;
      renderDashboard(data);
    });
}

function renderDashboard(data) {
  const table = document.getElementById("dashboardTable");
  table.innerHTML = "";
  data.forEach(t => {
    table.innerHTML += `
      <tr>
        <td>${t.student_name}</td>
        <td class="${t.usage ? "status-true" : "status-false"}">
          ${t.usage ? "Registered" : "Not Registered"}
        </td>
      </tr>
    `;
  });
}

function applyFilters() {
  const search = document.getElementById("searchInput").value.toLowerCase();
  const status = document.getElementById("statusFilter").value;
  const sort = document.getElementById("sortOrder").value;

  let filtered = dashboardData.filter(t =>
    t.student_name.toLowerCase().includes(search)
  );

  if (status === "registered") filtered = filtered.filter(t => t.usage);
  if (status === "not") filtered = filtered.filter(t => !t.usage);

  filtered.sort((a, b) =>
    sort === "az"
      ? a.student_name.localeCompare(b.student_name)
      : b.student_name.localeCompare(a.student_name)
  );

  renderDashboard(filtered);
}

function loadAttendance() {
  fetch(`/attendance/${eventId}`)
    .then(res => res.json())
    .then(data => {
      const table = document.getElementById("attendanceTable");
      table.innerHTML = "";
      data.forEach(name => {
        table.innerHTML += `<tr><td>${name}</td></tr>`;
      });
    });
}

loadDashboard();
</script>

</body>
</html>
