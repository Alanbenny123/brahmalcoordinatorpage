<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Event Dashboard</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 20px;
    }

    h1, h2 {
      margin: 5px 0;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    .header p {
      color: gray;
      margin: 0;
    }

    .actions {
      text-align: center;
      margin-bottom: 20px;
    }

    button {
      padding: 10px 16px;
      margin: 5px;
      border: none;
      background: #007bff;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }

    button.secondary {
      background: #6c757d;
    }

    button:hover {
      opacity: 0.9;
    }

    .count {
      text-align: center;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .container {
      display: flex;
      width: 200%;
      transition: transform 0.5s ease;
    }

    .panel {
      width: 50%;
      padding: 10px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }

    th {
      background: #f1f1f1;
    }

    .status-true {
      color: green;
      font-weight: bold;
    }

    .status-false {
      color: red;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <!-- HEADER -->
  <div class="header">
    <h1 id="eventName"></h1>
    <p id="eventId"></p>
  </div>

  <!-- ACTION BUTTONS -->
  <div class="actions">
    <button onclick="window.location.href='scan.html'">Scan/Register</button>
    <button onclick="showAttendance()">Attendance</button>
  </div>

  <!-- COUNT -->
  <div class="count">
    Total Registrations: <span id="count">Loading...</span>
  </div>

  <!-- SLIDE CONTAINER -->
  <div style="overflow:hidden">
    <div class="container" id="slider">

      <!-- DASHBOARD PANEL -->
      <div class="panel">
        <h2>Registered Students</h2>

        <table>
          <thead>
            <tr>
              <th>Student Name</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="dashboardTable"></tbody>
        </table>
      </div>

      <!-- ATTENDANCE PANEL -->
      <div class="panel">
        <h2>Attendance List</h2>
        <button class="secondary" onclick="showDashboard()">â¬… Back</button>

        <table>
          <thead>
            <tr>
              <th>Student Name</th>
            </tr>
          </thead>
          <tbody id="attendanceTable"></tbody>
        </table>
      </div>

    </div>
  </div>

<script>
  const eventId = localStorage.getItem("event_id");
  const eventName = localStorage.getItem("event_name");
  const slider = document.getElementById("slider");

  if (!eventId || !eventName) {
    alert("Session expired. Please login again.");
    window.location.href = "login.html";
  }

  document.getElementById("eventName").innerText = eventName;
  document.getElementById("eventId").innerText = "Event ID: " + eventId;

  /* SLIDE CONTROLS */
  function showAttendance() {
    slider.style.transform = "translateX(-50%)";
    loadAttendance();
  }

  function showDashboard() {
    slider.style.transform = "translateX(0)";
  }

  /* LOAD COUNT */
  fetch(`/count/${eventId}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById("count").innerText = data.count;
    });

  /* LOAD DASHBOARD TABLE */
  function loadDashboard() {
    fetch(`/tickets/${eventId}`)
      .then(res => res.json())
      .then(data => {
        const table = document.getElementById("dashboardTable");
        table.innerHTML = "";
        data.forEach(t => {
          table.innerHTML += `
            <tr>
              <td>${t.student_name}</td>
              <td class="${t.usage ? "status-true" : "status-false"}">
                ${t.usage ? "Registered" : "Not Registered"}
              </td>
            </tr>
          `;
        });
      });
  }

  /* LOAD ATTENDANCE */
  function loadAttendance() {
    fetch(`/attendance/${eventId}`)
      .then(res => res.json())
      .then(data => {
        const table = document.getElementById("attendanceTable");
        table.innerHTML = "";
        data.forEach(name => {
          table.innerHTML += `<tr><td>${name}</td></tr>`;
        });
      });
  }

  // Initial load
  loadDashboard();
</script>

</body>
</html>
